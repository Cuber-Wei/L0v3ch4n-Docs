import{a as i,c as e,e as a,o as t}from"./app-BjK21BRJ.js";const n={};function l(d,s){return t(),e("div",null,[...s[0]||(s[0]=[a(`<div class="hint-container important"><p class="hint-container-title">重要</p><p>系统能运行就已经很厉害了！系统能不出错就不要动它了！</p><p>每次执行命令前务必清楚知道这个命令会做些什么！</p></div><h2 id="事故背景" tabindex="-1"><a class="header-anchor" href="#事故背景"><span>事故背景</span></a></h2><p>负责的学校 OJ 开发接近尾声，最近正在往服务器上部署。由于有点无法忍受 Ubuntu 18 上版本低得离谱的 Docker 工具， 遂考虑升级 Docker 工具链。于是在 apt 的帮助下，主包成功地把系统更新挂了。</p><h2 id="数据抢救" tabindex="-1"><a class="header-anchor" href="#数据抢救"><span>数据抢救</span></a></h2><p>于是便紧急学习了如何进行数据抢救，做笔记如下：</p><h3 id="抢救思路" tabindex="-1"><a class="header-anchor" href="#抢救思路"><span>抢救思路</span></a></h3><p>我们可以从 ISO 的系统入手，将目标机器的文件系统挂载到 ISO 系统中，从而将重要的数据给拿取出来。</p><h3 id="具体操作" tabindex="-1"><a class="header-anchor" href="#具体操作"><span>具体操作</span></a></h3><p>首先先制作 Ubuntu Server Live ISO。</p><p>请从 U 盘启动，并选择 <strong>“Try or Install Ubuntu Server”</strong> 选项。通过<code>Help</code>菜单会启动到命令行终端界面。</p><p><strong>第一步：识别磁盘和分区，创建挂载点</strong></p><ol><li><p><strong>列出所有磁盘</strong>： 使用 <code>lsblk</code> 或 <code>fdisk</code> 命令来查看系统识别到的硬盘。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> lsblk</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>lsblk -f</code> 会显示文件系统类型（如 <code>ext4</code>, <code>ntfs</code>）和标签（LABEL），这能帮我们更好地识别哪个是原系统分区（比如标有 <code>OS</code> 或 <code>Ubuntu</code> 的分区）和数据分区。</li><li>找到原系统硬盘（比如 <code>sda</code>）和它的分区（比如 <code>sda1</code>, <code>sda3</code>）。</li></ul></li><li><p><strong>创建挂载点</strong>： 下面我们需要创建目录作为挂载点，以便访问硬盘里的内容。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/original_disk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><p><strong>第二步：挂载原系统分区</strong></p><p>假设数据在 <code>/dev/sda3</code> 上：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /dev/sda3</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/original_disk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>第三步：挂载备份介质（外接硬盘/U 盘）</strong></p><p>现在，将<strong>另一个</strong>U 盘或移动硬盘插入服务器。再次使用 <code>lsblk</code> 命令，它会作为一个新设备出现（比如 <code>/dev/sdc1</code>）。</p><ol><li><p><strong>创建挂载点并挂载</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mkdir</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/backup_drive</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> mount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /dev/sdc1</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/backup_drive</span><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">  # 请将 sdc1 替换为实际设备名</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>检查挂载结果</strong>： 使用 <code>df -h</code> 命令可以查看所有已挂载的磁盘及其可用空间，确认两个盘都挂载成功了。</p></li></ol><p><strong>第四步：复制数据</strong></p><p>现在，原系统数据在 <code>/mnt/original_disk</code>，备份盘在 <code>/mnt/backup_drive</code>。使用 <code>cp</code> 或 <code>rsync</code> 命令进行复制。</p><ul><li><p><strong>使用 <code>rsync</code> (可以保留权限、 ownership 等信息)</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> rsync</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -av</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> --progress</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/original_disk/home/your_username/</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/backup_drive/ubuntu_backup/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><code>-a</code>: 归档模式（保留所有属性）</li><li><code>-v</code>: 显示详细过程</li><li><code>--progress</code>: 显示传输进度</li><li>将 <code>your_username</code> 替换为原来的用户名。</li></ul></li><li><p><strong>使用 <code>cp</code> (简单直接)</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/original_disk/home/your_username/Documents</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/backup_drive/ubuntu_backup/</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> cp</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -r</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/original_disk/home/your_username/Pictures</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/backup_drive/ubuntu_backup/</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># ... 复制其他需要的重要文件夹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p><strong>常见的重要目录</strong></p><ul><li><code>/home/username/</code>（主要数据存放目录）</li><li><code>/etc/</code>（系统配置文件）</li></ul><p><strong>第五步：完成并卸载</strong></p><p>数据复制完成后，安全地卸载磁盘：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> umount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/original_disk</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">sudo</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> umount</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /mnt/backup_drive</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>然后便可以关机 (<code>sudo poweroff</code>)，拔掉所有 U 盘，数据就已经安全地备份到外接硬盘里了。</p><h2 id="重装系统" tabindex="-1"><a class="header-anchor" href="#重装系统"><span>重装系统</span></a></h2><p>然后就是重装系统了，这也是主包装过的第一个服务器系统。</p>`,29)])])}const h=i(n,[["render",l]]),p=JSON.parse('{"path":"/Misc/BreakServer/","title":"记一次炸服务器的经历","lang":"zh-CN","frontmatter":{"title":"记一次炸服务器的经历","createTime":"2025/08/24 14:08:15","permalink":"/Misc/BreakServer/","tags":["数据抢救"],"description":"重要 系统能运行就已经很厉害了！系统能不出错就不要动它了！ 每次执行命令前务必清楚知道这个命令会做些什么！ 事故背景 负责的学校 OJ 开发接近尾声，最近正在往服务器上部署。由于有点无法忍受 Ubuntu 18 上版本低得离谱的 Docker 工具， 遂考虑升级 Docker 工具链。于是在 apt 的帮助下，主包成功地把系统更新挂了。 数据抢救 于是...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"记一次炸服务器的经历\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2026-02-12T02:59:48.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://blog.l0v3ch4n.top/Misc/BreakServer/"}],["meta",{"property":"og:site_name","content":"L0v3ch4n"}],["meta",{"property":"og:title","content":"记一次炸服务器的经历"}],["meta",{"property":"og:description","content":"重要 系统能运行就已经很厉害了！系统能不出错就不要动它了！ 每次执行命令前务必清楚知道这个命令会做些什么！ 事故背景 负责的学校 OJ 开发接近尾声，最近正在往服务器上部署。由于有点无法忍受 Ubuntu 18 上版本低得离谱的 Docker 工具， 遂考虑升级 Docker 工具链。于是在 apt 的帮助下，主包成功地把系统更新挂了。 数据抢救 于是..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-02-12T02:59:48.000Z"}],["meta",{"property":"article:tag","content":"数据抢救"}],["meta",{"property":"article:modified_time","content":"2026-02-12T02:59:48.000Z"}]]},"readingTime":{"minutes":2.63,"words":789},"git":{"createdTime":1766990575000,"updatedTime":1770865188000,"contributors":[{"name":"Cuber-Wei","username":"Cuber-Wei","email":"cuberwei0@163.com","commits":3,"avatar":"https://avatars.githubusercontent.com/Cuber-Wei?v=4","url":"https://github.com/Cuber-Wei"}]},"autoDesc":true,"filePathRelative":"blog/Misc/记一次炸服务器的经历.md","headers":[],"categoryList":[{"id":"74248c","sort":10000,"name":"Misc"}]}');export{h as comp,p as data};
